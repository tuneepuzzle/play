class r{constructor(t,i,s,e){if(this.t=t,this.sampleRate=i,this.index=s,this.i=e,this.h=null,!this.i){this.o=r.l.createBuffer(2,this.t[0].length,this.sampleRate);var h=this.o.getChannelData(0),o=this.o.getChannelData(1),n=(h.set(this.t[0]),o.set(this.t[1]),1/32768*d/100);for(let t=0;t<this.t[0].length;t++)h[t]=this.t[0][t]*n,o[t]=this.t[1][t]*n;this.u=null}}static l=new AudioContext;play(){return this.i||(this.u=r.l.createBufferSource(),this.u.buffer=this.o,this.u.connect(r.l.destination),this.u.start()),this.t}}class i{constructor(t,i,s=!1){s&&console.log("Loading "+t);s=K(t);this.t=[s[0].reverse().map(t=>-t),s[1].reverse().map(t=>-t)],this.sampleRate=s[2],3<s.length?this.p=e(s[3],-1):this.p=null,4<s.length?this.m=e(s[4],-1):this.m=null,this.i=i}v(t){var i=Array.from({length:t},(t,i)=>i),s=(i.sort(()=>Math.random()-.5),[]),e=this.t[0].length,h=Math.ceil(e/t);let o=0;for(let t=0;t<e;t+=h){var n=[this.t[0].slice(t,t+h),this.t[1].slice(t,t+h)];s.push(new r(n,this.sampleRate,i[o],this.i)),o++}return s}}function e(t,i){return t.split("").map(t=>String.fromCharCode(t.charCodeAt(0)+i)).join("")}class o{constructor(t,i,s,e,h=!1){if(this.g=i*s,t.S.length!=this.g)throw new Error("Number of slot GUI elements ("+this.D.length+") does not match the number of slots ("+this.g+")");this.P=t,this.width=s,this.A=new Array(this.g).fill(null),this.D=[],this.i=e,this.B=h,this.I=!1,this.N=!1}reset(){this.A=new Array(this.g).fill(null),this.T()}M(t){var i=t.length;if(this.B&&console.log("Loading "+i+" pieces"),this.width<i)throw new Error("Board is not wide enough for "+i+" pieces");if(this.g<2*i)throw new Error("Board does not have enough space for "+i+" pieces");let s=!1;for(;!s;){this.reset();var e,h,o=Array.from({length:this.g},(t,i)=>i);for(let t=o.length-1;0<t;t--){var n=Math.floor(Math.random()*(t+1));[o[t],o[n]]=[o[n],o[t]]}for([e,h]of o.entries())this.A[h]=t[e];var r=this.C();r<=2?s=!0:this.B&&console.log("Maximum of "+r+" adjacent pieces, reassigning slots")}this.T()}C(){let i=0,s=1;for(let t=0;t<this.g;t++)null!=this.A[t]?t%this.width==0?i=1:++i>s&&(s=i):i=0;return s}F(t){return null!=this.A[t]}k(){var i=[];for(let t=0;t<this.g;t++)this.F(t)&&i.push(t);return i}G(){var i=this.k(),s=[];for(let t=0;t<this.g;t++)i.includes(t)||s.push(t);return s}U(i){if(!this.I){if(null==this.A[i])return console.log("Click on empty slot: "+i),null;{let t=i+1;for(;null!=this.A[t]&&t%this.width!=0;)t++;return this.B&&console.log("Playing from slot : "+i+" to "+(t-1)),this.O(i,t-1,!1)}}this._()}async O(s,e){if(this.i){var h=[];let i;for(let t=s;t<=e;t++)i=this.F(t)?this.A[t]:this.silentPiece,h.push(i.play());return h}e<s||this.N?(this.I=!1,this.N=!1):(this.I=!0,this.A[s].play(),this.P.j(s),this.A[s].u.onended=()=>{this.B&&console.log("Slot "+s+" finished playing"),this.P.R(s),this.N?this.N=!1:this.O(s+1,e)})}_(){this.I&&(this.B&&console.log("Interrupting audio"),this.I=!1,this.N=!0)}L(t,i){if(this.F(t))throw new Error("Slot "+t+" is already populated, cannot insert piece");this.A[t]=i,this.T()}H(t){var i;if(this.F(t))return i=this.A[t],this.A[t]=null,this.T(),i;throw new Error("Slot "+t+" is not populated, cannot remove piece")}q(t,i){if(!this.F(t))throw new Error("Slot "+t+" is not populated, cannot move piece");if(this.F(i))throw new Error("Slot "+i+" is already populated, cannot move piece");var s=this.A[t];return this.A[t]=null,this.A[i]=s,this.T(),s}V(i){for(let t=0;t<this.g;t++)if(this.A[t]==i)return t;return-1}T(){var t=this.k(),i=this.G();t.forEach(t=>{this.P.Y(t)}),i.forEach(t=>{this.P.J(t)})}}class n{constructor(t){this.P=t,this.K=0,this.W=null,this.X=null}reset(){this.K=0}advance(){this.K++,this.Z()}start(){this.X&&this.stop(),this.Z(),this.X=setInterval(this.advance.bind(this),1e3)}stop(){clearInterval(this.X),this.X=null}$(){this.W=this.P.tt,this.Z()}Z(){this.P.it(this.st())}st(){var t=Math.floor(this.K/3600).toString().padStart(2,"0"),i=Math.floor(this.K%3600/60).toString().padStart(2,"0"),s=(this.K%60).toString().padStart(2,"0");return this.K<3600?i+":"+s:t+":"+i+":"+s}}class t{constructor(t,i,s,e,h=!1){this.P=t,this.et=i,this.i=e,this.B=h,this.ht=!1,this.ot=null,this.nt=null,this.rt=s,this.lt=new o(this.P,s[0],s[1],this.i,this.B),this.tt=new n(this.P),this.at="",this.ut=null}start(t){this.ot=new i(t,this.i,this.B),this.P.ct(this.ot.p,this.ot.m),this.nt=this.ot.v(this.et),this.lt.reset(),this.lt.M(this.nt),this.ht=!1,this.$(),this.tt.start()}end(){this.dt(),this.ht=!0}q(t,i){return this.lt.F(t)&&!this.lt.F(i)?(this.lt.q(t,i),this.B&&console.log("Moved from slot "+t+" to slot "+i),!0):(console.log("Unable to move from slot "+t+" to slot "+i),!1)}vt(){var i=this.lt.V(this.nt[0]);if(i%this.rt[1]>this.rt[1]-this.et)return!1;for(let t=i;t<i+this.et;t++)if(this.lt.A[t]!=this.nt[t-i])return this.B&&console.log("Solution check: not solved"),!1;return console.log("Solution check: solved"),!0}$(){this.lt.T(),this.tt.$(),this.P.gt()}dt(){this.P.xt(),this.tt.stop(),this.P.ft()}wt(t){this.lt.U(t)}bt(t){this.ut=t,this.P.yt(Number(t.id)),this.lt.I&&(this.B&&console.log("Slot "+t.id+" moving, interrupting audio"),this.lt._())}St(){this.P.Dt(Number(this.ut.id)),this.ut=null}Pt(t){this.ht||(this.B&&console.log("Dropped on Slot: "+t.id),this.q(Number(this.ut.id),Number(t.id)),this.vt()&&(t=this.lt.V(this.nt[0]),this.lt.U(t),this.end()))}}let h="Tunee",l="Put the puzzle pieces in the right order to play today's music!",s="https://tuneepuzzle.github.io/play",a="tuneepuzzle@gmail.com",u=!0;var c=!1;let d=30,p=[5,6],m=[14,12],v=10,g=3,U=1.5,x=10,f=7*x,w="Verdana",b=1.3,y="#AFAFAF",S="#5F5F5F",D="#FFC000",P=3,A="10px",z=50*x,O=19*x,B=7*x,_=1.3,j=47*x,R=37*x,L=47*x,H=2.1,q=1e3,I=7*x,N=3e3;class V{constructor(t,i=!1){this.At=t,this.Bt=t.innerHTML,this.B=i,this.It=null}Nt(){var t=document.createElement("div"),i=(t.style.width=f+"px",t.style.height=f+"px",t.style.backgroundImage="url('images/piece.png')",t.style.backgroundSize="cover",t),t=t.cloneNode(!0),s=document.createElement("div"),e=(s.style.fontFamily=w,s.style.fontSize=H+"em",s.style.fontWeight="bold",s.style.color=S,s.style.userSelect="none",s.innerHTML=h,document.createElement("div")),i=(e.style.width="100%",e.style.height=f+"px",e.style.marginTop=x+"px",e.style.marginBottom=x+"px",e.style.paddingLeft=x+"px",e.style.paddingRight=x+"px",e.style.boxSizing="border-box",e.style.display="flex",e.style.justifyContent="space-between",e.style.alignItems="center",e.append(i),e.append(s),e.append(t),document.createElement("div")),s=(i.style.backgroundImage='url("images/copy.png")',i.style.backgroundSize="cover",i.style.width=I+"px",i.style.height=I+"px",i.onclick=this.Tt.bind(this),document.createElement("div")),t=(s.style.width="100%",s.style.backgroundColor=y,s.style.border=P+"px solid",s.style.borderRadius=A,s.style.marginBottom=x+"px",s.style.display="flex",s.style.flexDirection="column",s.style.placeItems="center",s.appendChild(e),this.At.style.marginBottom=x+"px",s.appendChild(this.At),document.createElement("div"));return t.style.width=L+"px",t.style.display="flex",t.style.flexDirection="column",t.style.placeItems="center",t.appendChild(s),t.appendChild(i),t}Tt(t){var i=this.Mt();this.B&&console.log(i),navigator.clipboard.writeText(i),this.Ct(t.target)}Ct(t){t.onclick=null,t.style.backgroundImage='url("images/copied.png")',setTimeout(()=>{t.onclick=this.Tt.bind(this),t.style.backgroundImage='url("images/copy.png")'},N)}Mt(){var t=new Date,t=t.getFullYear()+"/"+(t.getMonth()+1).toString().padStart(2,"0")+"/"+t.getDate().toString().padStart(2,"0"),i=String.fromCodePoint(127925),t=i+" "+h+", "+t+" "+i;return(t+="\n\nTime to solve: "+this.Bt)+("\n\n"+s+"\n")}}class Y{constructor(t,i,s,e=null,h=null,o=!1,n=!1){this.name=t,this.Ft=i,this.kt=s,this.p=e,this.m=h,this.Et=null,this.Gt=null,this.S=[],this.Ut=!0,this.zt=null,this.tt=null,this.Ot=null,this._t=this.jt(),this.i=o,(this.B=n)&&(c?console.log("Detected mobile environment"):console.log("Detected desktop environment")),this.Et=this.Rt()}ct(t,i){this.p=t,this.m=i}close(){this.Et&&this.Et.remove()}Rt(){return this.Et=document.createElement("div"),this.Et.style.margin="0 auto",this.Et.style.display="grid",this.Et.style.justifyItems="center",this.Et.style.alignItems="center",this.Et.appendChild(this.Lt()),this.Et.appendChild(this.Ht()),this.Et.appendChild(this.qt()),this.Et.appendChild(this.Vt()),this.Et}Lt(){var t=document.createElement("div"),i=(t.style.fontFamily=w,t.style.fontSize=g+"em",t.style.fontWeight="bold",t.style.color=S,t.innerHTML=this.name,document.createElement("div")),s=(i.style.fontFamily=w,i.style.fontSize=U+"em",i.style.fontWeight="bold",i.style.color=y,i.innerHTML=l,document.createElement("div"));return s.style.display="grid",s.style.placeItems="center",s.appendChild(t),s.appendChild(i),s}Ht(){var i=document.createElement("div");i.style.backgroundColor=y,i.style.border=P+"px solid",i.style.width=f*this.kt+"px",i.style.height=f*this.Ft+"px",i.style.marginTop=2*x+"px",i.style.display="flex",i.style.flexWrap="wrap";for(let t=0;t<this.Ft*this.kt;t++){var s=this.Yt(t,c);i.appendChild(s),this.S.push(s)}return i}Yt(t){let i=document.createElement("div");return i.classList.add("board-slot"),i.id=t,i.style.width=f+"px",i.style.height=f+"px",i.style.border="dotted 0.25px",i.style.boxSizing="border-box",i.draggable=!1,c?((t=new Hammer(i)).get("pan").set({direction:Hammer.DIRECTION_ALL}),t.on("tap",()=>{u&&console.log("Tap: slot "+i.id),F.wt(Number(i.id))}),t.on("panstart",()=>{this.Jt(i)&&(u&&console.log("Drag start: slot "+i.id),F.bt(i))}),t.on("panend",t=>{this.Jt(i)&&(u&&(console.log("Drag end: slot "+i.id),t=document.elementFromPoint(t.center.x,t.center.y),this.S.includes(t))&&(this.B&&console.log("Dropped on slot "+t.id),t==i?(u&&console.log("Play: slot "+i.id),F.wt(Number(i.id))):F.Pt(t)),F.St())})):(i.onmouseover=()=>{this.Ut&&i.classList.contains("piece")&&this.Kt(i.id)},i.onmouseout=()=>{this.Qt(i.id)},i.onclick=()=>{u&&console.log("Play: slot "+i.id),F.wt(Number(i.id))},i.ondragstart=t=>{u&&console.log("Drag start: slot "+i.id),this.Qt(i.id),t.stopPropagation(),t.dataTransfer.setDragImage(this._t,f/2,f/2),t.dataTransfer.effectAllowed="move",F.bt(i)},i.ondragend=t=>{u&&console.log("Drag end: slot "+i.id),this.Qt(i.id),t.preventDefault(),F.St()},i.ondrop=()=>{u&&console.log("Drop: slot "+i.id),this.Qt(i.id),F.Pt(i)}),i}Jt(t){return t.classList.contains("piece")}jt(){var t=new Image,i=(t.src="images/piece_dragged.png",t.style.width=f+"px",t.style.height=f+"px",document.createElement("div"));return i.appendChild(t),i.style.position="absolute",i.style.top=2*-f+"px",i.style.left=2*-f+"px",i}Y(t){this.S[t].classList.add("piece"),this.S[t].draggable=!0,this.S[t].ondragover=null}J(t){this.S[t].classList.remove("piece"),this.S[t].draggable=!1,this.S[t].ondragover=t=>{t.stopPropagation(),t.preventDefault()}}yt(t){this.S[t].classList.add("piece-dragged")}Dt(t){this.S[t].classList.remove("piece-dragged")}j(t){this.S[t].classList.add("piece-playing")}R(t){this.S[t].classList.remove("piece-playing")}Kt(t){"string"==typeof t&&(t=Number(t)),this.S[t].classList.add("piece-mouseover")}Qt(t){"string"==typeof t&&(t=Number(t)),this.S[t].classList.remove("piece-mouseover")}xt(){var i;this.Ut=!1;for(let t=0;t<this.g;t++)i=this.S[t],this.B&&console.log("Inactivating slot "+t),i.draggable=!1,this.Qt(t)}Wt(){return this.zt=document.createElement("div"),this.zt.classList.add("action-button"),this.zt.style.backgroundColor=D,this.zt.style.border=P+"px solid",this.zt.style.borderRadius=A,this.zt.style.width=10*x+"px",this.zt.style.height=10*x+"px",this.zt.style.fontFamily=w,this.zt.style.fontSize=b+"em",this.zt.style.fontWeight="bold",this.zt.style.color=S,this.zt.style.display="flex",this.zt.style.alignItems="center",this.zt.style.justifyContent="center",this.zt.style.userSelect="none",this.zt}Xt(t){this.zt.onclick=t}Zt(t){this.zt.style.backgroundImage=t,this.zt.style.backgroundSize="cover"}$t(t){this.zt.innerHTML=t}gt(){this.$t(""),this.Zt("url('images/game_on.png')"),this.Xt(null)}ti(t){this.Zt(""),this.$t("Share"),this.Xt(t)}ii(t){this.$t("Copied"),this.Xt(null),setTimeout(t,N)}si(){return this.tt=document.createElement("div"),this.tt.classList.add("timer"),this.tt.style.backgroundColor=D,this.tt.style.border=P+"px solid",this.tt.style.borderRadius=A,this.tt.style.width=15*x+"px",this.tt.style.height=8*x+"px",this.tt.style.fontFamily=w,this.tt.style.fontSize=b+"em",this.tt.style.fontWeight="bold",this.tt.style.color=S,this.tt.style.display="flex",this.tt.style.alignItems="center",this.tt.style.justifyContent="center",this.tt.style.userSelect="none",this.tt.innerHTML="00:00",this.tt}it(t){this.tt.innerHTML=t}qt(){var t=document.createElement("div");return t.style.width=z+"px",t.style.height=O+"px",t.style.backgroundColor=y,t.style.border=P+"px solid",t.style.borderRadius=A,t.style.marginLeft="auto",t.style.marginRight="auto",t.style.marginTop=x+"px",t.style.display="flex",t.style.justifyContent="space-around",t.style.alignItems="center",t.appendChild(this.Wt()),t.appendChild(this.si()),this.Gt=t}Vt(){return this.Ot=document.createElement("div"),this.Ot.style.backgroundImage='url("images/feedback.png")',this.Ot.style.backgroundSize="cover",this.Ot.style.width=B+"px",this.Ot.style.height=B+"px",this.Ot.style.marginTop=x+"px",this.Ot.title=a,this.Ot.style.cursor="pointer",this.Ot.onclick=()=>{window.location.href="mailto:"+a},this.Ot}ei(){var t=document.createElement("div");return null!=this.p&&(t.style.fontFamily=w,t.style.fontSize=_+"em",t.style.fontWeight="bold",t.style.color=S,t.style.whiteSpace="pre-wrap",t.innerHTML=this.p,this.B)&&console.log(this.p),t}hi(){var t,i=document.createElement("div");return null!=this.m&&(i.style.width=j+"px",i.style.height=R+"px",i.style.display="flex",i.style.justifyContent="center",i.style.alignItems="center",(t=document.createElement("iframe")).width="100%",t.height="100%",t.src="https://www.youtube.com/embed/"+this.m,t.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",t.allowFullscreen=!0,i.appendChild(t)),i}oi(){var t=document.createElement("div");return t.style.display="flex",t.style.flexDirection="column",t.style.placeItems="center",t.appendChild(this.ei()),t.style.gap=x+"px",t.appendChild(this.hi()),t}ft(){var t=new V(this.tt,this.B).Nt();let i=document.createElement("div"),s=(i.style.display="flex",i.style.alignItems="center",i.style.marginTop=x+"px",i.appendChild(t),null==this.p&&null==this.m||(t=this.oi(),i.style.gap=3*x+"px",i.appendChild(t)),this.Gt.style.opacity=1,this.Ot.style.opacity=1,setInterval(()=>{0<this.Gt.style.opacity?(this.Gt.style.opacity-=.05,this.Ot.style.opacity-=.05):(this.Gt.remove(),this.Gt.remove(),clearInterval(s),this.Et.append(i),this.Ot.style.opacity=1,this.Et.append(this.Ot))},q/20));return i}}function J(){var t=new Date;return"audio_data/"+t.getFullYear()+(t.getMonth()+1).toString().padStart(2,"0")+t.getDate().toString().padStart(2,"0")+".js"}function K(t=""){let i;return""==t?i=loadAudioDataByDate():"small.wav"==t&&(i=[[145,219,368,575,699,740,740,744,598,587,389,70,-20,-93,-455,-610,-494,-664,-763,-652,-680,-625,-564,-458,-420,-49,107,174,527,728,847,803,914,940,630,413,320,11,-338,-480,-706,-815,-767,-928,-924,-705,-674,-744,-365,-140,-138,195,472,612,815,877,908,985,948,689,438,310,9,-383,-523,-632,-870,-1001,-854,-828,-806,-648,-519,-385,-92,92,174,459,664,635,782,905,834,682,595,468,133,-34,-282,-524,-516,-610,-794,-701,-626,-746,-662,-413,-425,-279,-78,93,304,570,600,697,944,867,753,625,481,290,-104,-245,-382,-633,-767,-727,-751,-829,-715,-791,-602,-342,-281,-133,215,393,434,773,877,859,906,767,675,498,227,-91,-301,-434,-636,-770,-779,-783,-827,-753,-569,-475,-404,-206,3,170,357,484,613,779,868,779,746,656,401,126,-13,-177,-513,-574,-650,-761,-714,-708,-758,-603,-444,-475,-288,-15,26,244,469,619,746,863,832,791,728,431,188,-17,-206,-371,-628,-690,-736,-848,-807,-704,-681,-639,-392,-283,-60,178,250,496,759,843,868,968,853,628,525,272,17,-256,-485,-606,-708,-778,-872,-825,-762,-691,-567,-367,-160,-122,103,358,552,670,769,895,908,792,661,489,239,8,-233,-441,-546,-688,-856,-808,-758,-807,-706,-514,-432,-268,-97,73,323,557,623,859,944,920,878,695,511,259,-6,-267,-386,-591,-795,-827,-897,-841,-761,-751,-580,-383,-280,-124,216,323,470,694,844,976,932,796,665,500,228,-60,-231,-455,-676,-810,-843,-830,-889,-857,-677,-508,-413,-283,-65,133,321,477,718,842,878,856,788,738,467,151,-11,-193,-446,-601,-704,-828,-821,-792,-793,-620,-514,-478,-303,-67,23,232,434,637,820,835,832,841,640,433,288,6,-212,-390,-650,-740,-753,-901,-913,-725,-687,-648,-430,-336,-160,34,206,420,692,759,798],[145,223,370,576,701,740,740,741,602,588,392,70,-18,-96,-455,-613,-498,-662,-765,-650,-677,-622,-560,-454,-422,-49,110,175,530,727,851,807,913,942,632,414,317,13,-338,-484,-702,-814,-768,-925,-923,-701,-678,-743,-361,-136,-141,195,469,616,811,873,912,988,948,690,436,314,7,-379,-522,-628,-866,-999,-853,-827,-806,-647,-519,-385,-96,96,178,460,662,637,785,908,837,685,599,464,129,-35,-284,-523,-520,-608,-791,-701,-624,-743,-664,-410,-428,-276,-82,97,302,573,600,693,946,864,752,624,485,289,-107,-246,-380,-637,-768,-726,-750,-831,-715,-790,-603,-344,-282,-129,218,389,432,769,879,858,908,764,677,495,231,-87,-302,-434,-639,-774,-775,-782,-827,-751,-567,-479,-406,-202,2,168,355,487,613,780,866,783,749,653,405,122,-15,-178,-515,-575,-654,-762,-712,-712,-759,-606,-445,-474,-289,-12,25,246,471,616,747,860,832,790,726,435,188,-13,-205,-370,-628,-692,-736,-851,-806,-700,-678,-641,-389,-280,-62,177,250,492,759,840,870,964,850,624,526,272,17,-256,-481,-608,-707,-781,-873,-823,-764,-693,-571,-366,-162,-123,104,359,555,674,767,895,906,795,657,487,236,6,-232,-445,-548,-692,-852,-811,-757,-811,-710,-510,-431,-268,-98,73,325,561,625,862,947,920,878,698,515,261,-8,-263,-382,-589,-792,-825,-897,-844,-765,-752,-576,-386,-278,-127,212,319,467,698,844,979,934,797,663,496,228,-62,-229,-454,-673,-811,-846,-829,-892,-860,-674,-506,-412,-283,-66,130,318,478,715,845,879,855,791,742,470,155,-11,-194,-444,-605,-702,-832,-825,-796,-793,-621,-513,-475,-307,-63,21,229,430,639,819,837,836,839,637,434,286,7,-215,-393,-649,-740,-756,-902,-917,-724,-691,-646,-434,-339,-158,32,210,424,695,760,800],1122]),i}document.title=h;let T=document.createElement("link"),Q=(T.setAttribute("rel","shortcut icon"),T.setAttribute("href","images/piece_mouseover.png"),document.head.appendChild(T),/Android/i.test(navigator.userAgent)),W=/iPhone|iPad|iPod/i.test(navigator.userAgent),M=(c=Q||W,Number(c)),C=new Y(h,p[M],m[M],null,null,!1,u),F=new t(C,v,[p[M],m[M]],!1,u),X=(document.body.appendChild(C.Et),C.$t("Start"),C.Xt(Z),document.body.appendChild(C._t),new URLSearchParams(window.location.search)),k=X.get("d"),E,G=(E=null!=k?"audio_data/"+k+".js":J(),document.createElement("script"));function Z(){F.start("")}G.src=E,document.body.appendChild(G);
