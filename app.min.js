class n{constructor(t,i,s,e){this.startTime=t,this.endTime=i,this.t=s,this.index=e}}class e{constructor(t,i,s){this.startTime=t,this.endTime=i,this.i=s}h(i){var s=(this.endTime-this.startTime)/i;let e=this.startTime;var h=[];let o;for(let t=0;t<i;t+=1)o=0==t?1:t==i-1?2:0,h.push(new n(e,e+s,o,t,this.i)),e+=s;return h}}class o{constructor(t,i,s,e,h=!1){if(this.o=i*s,t.l.length!=this.o)throw new Error("Number of slot GUI elements ("+this.u.length+") does not match the number of slots ("+this.o+")");this.p=t,this.m=null,this.v=null,this.width=s,this.g=new Array(this.o).fill(null),this.u=[],this.i=e,this.S=h,this.D=!1,this.P=!1}reset(){this.g=new Array(this.o).fill(null),this.C()}I(t,i){var s=t.length;if(this.S&&console.log("Loading "+s+" pieces"),this.width<s)throw new Error("Board is not wide enough for "+s+" pieces");if(this.o<2*s)throw new Error("Board does not have enough space for "+s+" pieces");let e=!1;for(;!e;){this.reset();var h,o,n=Array.from({length:this.o},(t,i)=>i);for(let t=n.length-1;0<t;t--){var r=Math.floor(Math.random()*(t+1));[n[t],n[r]]=[n[r],n[t]]}for([h,o]of n.entries())this.g[o]=t[h];var l=this.A();l<=2?e=!0:this.S&&console.log("Maximum of "+l+" adjacent pieces, reassigning slots")}this.m=i,this.i||this.m.getVolume(function(t){this.v=t}.bind(this)),this.C()}A(){let i=0,s=1;for(let t=0;t<this.o;t++)null!=this.g[t]?t%this.width==0?i=1:++i>s&&(s=i):i=0;return s}T(t){return null!=this.g[t]}k(){var i=[];for(let t=0;t<this.o;t++)this.T(t)&&i.push(t);return i}F(){var i=this.k(),s=[];for(let t=0;t<this.o;t++)i.includes(t)||s.push(t);return s}B(i){if(this.D)this.N();else{if(null!=this.g[i]){let t=i+1;for(;null!=this.g[t]&&t%this.width!=0;)t++;if(t--,this.S&&console.log("Playing from slot : "+i+" to "+t),this.i)return[i,t];this.M(i,t,!1)}console.log("Click on empty slot: "+i)}return null}async M(e,h,t=null){if(h<e)this.m.bind(SC.Widget.Events.PAUSE,()=>{this.m.unbind(SC.Widget.Events.PAUSE),this.D=!1,this.P=!1}),this.m.pause();else if(this.P)this.S&&console.log("Playing interrupted, not playing slot "+e),this.p.G(e),this.m.bind(SC.Widget.Events.PAUSE,()=>{this.m.unbind(SC.Widget.Events.PAUSE),this.D=!1,this.P=!1}),this.m.pause(),this.D=!1,this.P=!1;else{let i=this.g[e];this.D=!0,this.m.setVolume(this.v),null!=t&&i.index!=t.index+1&&this.m.seekTo(1e3*i.startTime),this.p.U(e),this.m.bind(SC.Widget.Events.PLAY,()=>{this.m.unbind(SC.Widget.Events.PLAY);let s=this.v/10;if(1==i.t){let t=0,i=(this.m.setVolume(t),setInterval(function(){t<this.v?(t+=s,this.m.setVolume(t)):clearInterval(i)}.bind(this),m/10*1e3))}var t;2==i.t&&(t=i.endTime-i.startTime-m,setTimeout(()=>{let t=this.v,i=setInterval(function(){0<t?(t-=s,this.m.setVolume(t)):(clearInterval(i),setTimeout(()=>{this.m.setVolume(this.v)},m/10*1e3))}.bind(this),m/10*1e3)},1e3*t)),setTimeout(()=>{this.p.G(e),this.M(e+1,h,i)},1e3*(i.endTime-i.startTime))}),this.m.play(),document.addEventListener("playEnd",this.playEndEventHandler)}}N(){this.D&&(this.S&&console.log("Interrupting audio"),this.D=!1,this.P=!0)}O(t,i){if(this.T(t))throw new Error("Slot "+t+" is already populated, cannot insert piece");this.g[t]=i,this.C()}_(t){var i;if(this.T(t))return i=this.g[t],this.g[t]=null,this.C(),i;throw new Error("Slot "+t+" is not populated, cannot remove piece")}q(t,i){if(!this.T(t))throw new Error("Slot "+t+" is not populated, cannot move piece");if(this.T(i))throw new Error("Slot "+i+" is already populated, cannot move piece");var s=this.g[t];return this.g[t]=null,this.g[i]=s,this.C(),s}H(i){for(let t=0;t<this.o;t++)if(this.g[t]==i)return t;return-1}C(){var t=this.k(),i=this.F();t.forEach(t=>{this.p.R(t)}),i.forEach(t=>{this.p.W(t)})}}class r{constructor(t){this.p=t,this.j=0,this.V=null,this.Y=null}reset(){this.j=0}advance(){this.j++,this.L()}start(){this.Y&&this.stop(),this.L(),this.Y=setInterval(this.advance.bind(this),1e3)}stop(){clearInterval(this.Y),this.Y=null}J(){this.V=this.p.K,this.L()}L(){this.p.X(this.Z())}Z(){var t=Math.floor(this.j/3600).toString().padStart(2,"0"),i=Math.floor(this.j%3600/60).toString().padStart(2,"0"),s=(this.j%60).toString().padStart(2,"0");return this.j<3600?i+":"+s:t+":"+i+":"+s}}class t{constructor(t,i,s,e,h=!1){this.p=t,this.$=i,this.i=e,this.S=h,this.tt=!1,this.it=null,this.st=null,this.et=s,this.ht=new o(this.p,s[0],s[1],this.i,this.S),this.K=new r(this.p),this.ot="",this.nt=null}start(t,i,s,e){if(this.p.rt(t),this.i)this.lt(null,s,e);else{let t=this.p.ut(i);t.bind(SC.Widget.Events.READY,()=>{t.unbind(SC.Widget.Events.READY),this.lt(t,s,e)})}}lt(t,i,s){this.it=new e(i,s,this.i),this.st=this.it.h(this.$),this.ht.reset(),this.ht.I(this.st,t),this.tt=!1,this.J(),this.K.start()}end(){this.ct(),this.tt=!0}q(t,i){return this.ht.T(t)&&!this.ht.T(i)?(this.ht.q(t,i),this.S&&console.log("Moved from slot "+t+" to slot "+i),!0):(console.log("Unable to move from slot "+t+" to slot "+i),!1)}at(){var i=this.ht.H(this.st[0]);if(i%this.et[1]>this.et[1]-this.$)return!1;for(let t=i;t<i+this.$;t++)if(this.ht.g[t]!=this.st[t-i])return this.S&&console.log("Solution check: not solved"),!1;return console.log("Solution check: solved"),!0}J(){this.ht.C(),this.K.J(),this.p.dt()}ct(){this.p.vt(),this.K.stop(),this.p.gt()}ft(t){this.ht.B(t)}xt(t){this.nt=t,this.p.wt(Number(t.id)),this.ht.D&&(this.S&&console.log("Slot "+t.id+" moving, interrupting audio"),this.ht.N())}St(){this.p.yt(Number(this.nt.id)),this.nt=null}bt(t){this.tt||(this.S&&console.log("Dropped on Slot: "+t.id),this.q(Number(this.nt.id),Number(t.id)),this.at()&&(t=this.ht.H(this.st[0]),this.ht.B(t),this.end()))}}let h="Tunee",l="Put the puzzle pieces in the right order to play today's music!",s="https://tuneepuzzle.github.io/play",i="tuneepuzzle@gmail.com",u=!0;var c=!1;let a=[5,6],d=[14,12],p=10,U=3,O=1.5,m=.5,v=10,g=7*v,f="Verdana",x=1.3,w="#AFAFAF",S="#5F5F5F",y="#FFC000",b=3,D="10px",_=50*v,z=19*v,P=7*v,q=.75,H=1.3,C=47.5*v,R=47.5*v,W=2.1,j=1e3,I=7*v,A=3e3;class V{constructor(t,i=!1){this.Dt=t,this.Pt=t.innerHTML,this.S=i,this.Ct=null}It(){var t=document.createElement("div"),i=(t.style.width=g+"px",t.style.height=g+"px",t.style.backgroundImage="url('images/piece.png')",t.style.backgroundSize="cover",t),t=t.cloneNode(!0),s=document.createElement("div"),e=(s.style.fontFamily=f,s.style.fontSize=W+"em",s.style.fontWeight="bold",s.style.color=S,s.style.userSelect="none",s.innerHTML=h,document.createElement("div")),i=(e.style.width="100%",e.style.height=g+"px",e.style.marginTop=v+"px",e.style.marginBottom=v+"px",e.style.paddingLeft=v+"px",e.style.paddingRight=v+"px",e.style.boxSizing="border-box",e.style.display="flex",e.style.justifyContent="space-between",e.style.alignItems="center",e.append(i),e.append(s),e.append(t),document.createElement("div")),s=(i.style.backgroundImage='url("images/copy.png")',i.style.backgroundSize="cover",i.style.width=I+"px",i.style.height=I+"px",i.onclick=this.At.bind(this),document.createElement("div")),t=(s.style.width="100%",s.style.backgroundColor=w,s.style.border=b+"px solid",s.style.borderRadius=D,s.style.marginBottom=v+"px",s.style.display="flex",s.style.flexDirection="column",s.style.placeItems="center",s.appendChild(e),this.Dt.style.marginBottom=v+"px",s.appendChild(this.Dt),document.createElement("div"));return t.style.width=R+"px",t.style.display="flex",t.style.flexDirection="column",t.style.placeItems="center",t.appendChild(s),t.appendChild(i),t}At(t){var i=this.Tt();this.S&&console.log(i),navigator.clipboard.writeText(i),this.kt(t.target)}kt(t){t.onclick=null,t.style.backgroundImage='url("images/copied.png")',setTimeout(()=>{t.onclick=this.At.bind(this),t.style.backgroundImage='url("images/copy.png")'},A)}Tt(){var t=new Date,t=t.getFullYear()+"/"+(t.getMonth()+1).toString().padStart(2,"0")+"/"+t.getDate().toString().padStart(2,"0"),i=String.fromCodePoint(127925),t=i+" "+h+", "+t+" "+i;return(t+="\n\nTime to solve: "+this.Pt)+("\n\n"+s+"\n")}}class Y{constructor(t,i,s,e=null,h=null,o=!1,n=!1){this.name=t,this.Ft=i,this.Bt=s,this.Nt=e,this.Mt=h,this.Et=null,this.Gt=null,this.l=[],this.Ut=!0,this.Ot=null,this.K=null,this._t=null,this.zt=null,this.qt=this.Ht(),this.Nt="",this.i=o,(this.S=n)&&(c?console.log("Detected mobile environment"):console.log("Detected desktop environment")),this.Et=this.Rt()}close(){this.Et&&this.Et.remove()}Rt(){return this.Et=document.createElement("div"),this.Et.style.margin="0 auto",this.Et.style.display="grid",this.Et.style.justifyItems="center",this.Et.style.alignItems="center",this.Et.appendChild(this.Wt()),this.Et.appendChild(this.jt()),this.Et.appendChild(this.Vt()),this.Et.appendChild(this.Yt()),this.Et.appendChild(this.Lt()),this.Et.appendChild(this.Jt()),this.Et}Yt(){return this.Kt=document.createElement("div"),this.Kt.style.width=C+"px",this.Qt=document.createElement("iframe"),this.Qt.width="100%",this.Kt.appendChild(this.Qt),this.Kt.style.position="absolute",this.Kt.style.left=-2*C+"px",this.Kt}ut(t){return this.Qt.src=t,SC.Widget(this.Qt)}Wt(){var t=document.createElement("div"),i=(t.style.fontFamily=f,t.style.fontSize=U+"em",t.style.fontWeight="bold",t.style.color=S,t.innerHTML=this.name,document.createElement("div")),s=(i.style.fontFamily=f,i.style.fontSize=O+"em",i.style.fontWeight="bold",i.style.color=w,i.innerHTML=l,document.createElement("div"));return s.style.display="grid",s.style.placeItems="center",s.appendChild(t),s.appendChild(i),s}jt(){var i=document.createElement("div");i.style.backgroundColor=w,i.style.border=b+"px solid",i.style.width=g*this.Bt+"px",i.style.height=g*this.Ft+"px",i.style.marginTop=2*v+"px",i.style.display="flex",i.style.flexWrap="wrap";for(let t=0;t<this.Ft*this.Bt;t++){var s=this.Xt(t,c);i.appendChild(s),this.l.push(s)}return i}Xt(t){let i=document.createElement("div");return i.classList.add("board-slot"),i.id=t,i.style.width=g+"px",i.style.height=g+"px",i.style.border="dotted 0.25px",i.style.boxSizing="border-box",i.draggable=!1,c?((t=new Hammer(i)).get("pan").set({direction:Hammer.DIRECTION_ALL}),t.on("tap",()=>{u&&console.log("Tap: slot "+i.id),M.ft(Number(i.id))}),t.on("panstart",()=>{this.Zt(i)&&(u&&console.log("Drag start: slot "+i.id),M.xt(i))}),t.on("panend",t=>{this.Zt(i)&&(u&&(console.log("Drag end: slot "+i.id),t=document.elementFromPoint(t.center.x,t.center.y),this.l.includes(t))&&(this.S&&console.log("Dropped on slot "+t.id),t==i?(u&&console.log("Play: slot "+i.id),M.ft(Number(i.id))):M.bt(t)),M.St())})):(i.onmouseover=()=>{this.Ut&&i.classList.contains("piece")&&this.$t(i.id)},i.onmouseout=()=>{this.ti(i.id)},i.onclick=()=>{u&&console.log("Play: slot "+i.id),M.ft(Number(i.id))},i.ondragstart=t=>{u&&console.log("Drag start: slot "+i.id),this.ti(i.id),t.stopPropagation(),t.dataTransfer.setDragImage(this.qt,g/2,g/2),t.dataTransfer.effectAllowed="move",M.xt(i)},i.ondragend=t=>{u&&console.log("Drag end: slot "+i.id),this.ti(i.id),t.preventDefault(),M.St()},i.ondrop=()=>{u&&console.log("Drop: slot "+i.id),this.ti(i.id),M.bt(i)}),i}Zt(t){return t.classList.contains("piece")}Ht(){var t=new Image,i=(t.src="images/piece_dragged.png",t.style.width=g+"px",t.style.height=g+"px",document.createElement("div"));return i.appendChild(t),i.style.position="absolute",i.style.top=2*-g+"px",i.style.left=2*-g+"px",i}R(t){this.l[t].classList.add("piece"),this.l[t].draggable=!0,this.l[t].ondragover=null}W(t){this.l[t].classList.remove("piece"),this.l[t].draggable=!1,this.l[t].ondragover=t=>{t.stopPropagation(),t.preventDefault()}}wt(t){this.l[t].classList.add("piece-dragged")}yt(t){this.l[t].classList.remove("piece-dragged")}U(t){this.l[t].classList.add("piece-playing")}G(t){this.l[t].classList.remove("piece-playing")}$t(t){"string"==typeof t&&(t=Number(t)),this.l[t].classList.add("piece-mouseover")}ti(t){"string"==typeof t&&(t=Number(t)),this.l[t].classList.remove("piece-mouseover")}vt(){var i;this.Ut=!1;for(let t=0;t<this.o;t++)i=this.l[t],this.S&&console.log("Inactivating slot "+t),i.draggable=!1,this.ti(t)}ii(){return this.Ot=document.createElement("div"),this.Ot.classList.add("action-button"),this.Ot.style.backgroundColor=y,this.Ot.style.border=b+"px solid",this.Ot.style.borderRadius=D,this.Ot.style.width=10*v+"px",this.Ot.style.height=10*v+"px",this.Ot.style.fontFamily=f,this.Ot.style.fontSize=x+"em",this.Ot.style.fontWeight="bold",this.Ot.style.color=S,this.Ot.style.display="flex",this.Ot.style.alignItems="center",this.Ot.style.justifyContent="center",this.Ot.style.userSelect="none",this.Ot}si(t){this.Ot.onclick=t}ei(t){this.Ot.style.backgroundImage=t,this.Ot.style.backgroundSize="cover"}hi(t){this.Ot.innerHTML=t}dt(){this.hi(""),this.ei("url('images/game_on.png')"),this.si(null)}oi(t){this.ei(""),this.hi("Share"),this.si(t)}ni(t){this.hi("Copied"),this.si(null),setTimeout(t,A)}ri(){return this.K=document.createElement("div"),this.K.classList.add("timer"),this.K.style.backgroundColor=y,this.K.style.border=b+"px solid",this.K.style.borderRadius=D,this.K.style.width=15*v+"px",this.K.style.height=8*v+"px",this.K.style.fontFamily=f,this.K.style.fontSize=x+"em",this.K.style.fontWeight="bold",this.K.style.color=S,this.K.style.display="flex",this.K.style.alignItems="center",this.K.style.justifyContent="center",this.K.style.userSelect="none",this.K.innerHTML="00:00",this.K}X(t){this.K.innerHTML=t}Vt(){var t=document.createElement("div");return t.style.width=_+"px",t.style.height=z+"px",t.style.backgroundColor=w,t.style.border=b+"px solid",t.style.borderRadius=D,t.style.marginLeft="auto",t.style.marginRight="auto",t.style.marginTop=v+"px",t.style.display="flex",t.style.justifyContent="space-around",t.style.alignItems="center",t.appendChild(this.ii()),t.appendChild(this.ri()),this.Gt=t}Lt(){return this._t=document.createElement("div"),this._t.style.backgroundImage='url("images/feedback.png")',this._t.style.backgroundSize="cover",this._t.style.width=P+"px",this._t.style.height=P+"px",this._t.style.marginTop=v+"px",this._t.title=i,this._t.style.cursor="pointer",this._t.onclick=()=>{window.open("mailto:"+i,"_blank")},this._t}Jt(){this.zt=document.createElement("div");var t=document.createElement("a"),i=(t.href="https://www.soundcloud.com/",t.textContent="SoundCloud",t.target="_blank",t.style.textDecoration="none",t.style.color=S,document.createElement("a")),t=(i.href="privacy.html",i.textContent="Privacy Policy",i.target="_blank",i.style.textDecoration="none",i.style.color=S,this.zt.style.fontFamily=f,this.zt.style.fontSize=q+"em",this.zt.style.fontWeight="bold",this.zt.style.color=w,this.zt.style.textAlign="center",this.zt.appendChild(document.createTextNode("Music played using the ")),this.zt.appendChild(t),this.zt.appendChild(document.createTextNode(' waveform player ("Widget").')),document.createElement("br"));return this.zt.appendChild(t),this.zt.appendChild(document.createTextNode("All music used in this game is copyrighted and belongs to its legal owners.")),this.zt.appendChild(t.cloneNode()),this.zt.appendChild(i),this.zt}rt(t){this.Nt=t}li(){var t=document.createElement("div");return t.style.fontFamily=f,t.style.fontSize=H+"em",t.style.fontWeight="bold",t.style.color=S,t.style.whiteSpace="pre-wrap",t.innerHTML=this.Nt,this.S&&console.log(this.Nt),t}ui(){var t=document.createElement("div"),i=(t.style.display="flex",t.style.flexDirection="column",t.style.placeItems="center",t.appendChild(this.li()),t.style.gap=v+"px",this.Kt.cloneNode(!0));return i.style.position="",t.appendChild(i),t}gt(){var t=new V(this.K,this.S).It();let i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.marginTop=v+"px",i.appendChild(t);t=this.ui();i.style.gap=2*v+"px",i.appendChild(t),this.Gt.style.opacity=1,this._t.style.opacity=1,this.zt.style.opacity=1;let s=setInterval(()=>{0<this.Gt.style.opacity?(this.Gt.style.opacity-=.05,this._t.style.opacity-=.05,this.zt.style.opacity-=.05):(this.Gt.remove(),this.Gt.remove(),clearInterval(s),this.Et.append(i),this._t.style.opacity=1,this.zt.style.opacity=1,this.Et.append(this._t),this.Et.append(this.zt))},j/20);return i}}function L(){var t=new Date;return t.getFullYear()+(t.getMonth()+1).toString().padStart(2,"0")+t.getDate().toString().padStart(2,"0")}let T=["53583438","Frogsod|=#Ylyd#Od#Ylgd","588::363<",177.75,183.15,"53583439","Frogsod|=#Ylyd#Od#Ylgd","588::363<",177.75,183.15,"5358343:","Gdylg#Jxhwwd=#Wlwdqlxp#+ihdw1#Vld,","549873;:8",71.5,77.5,"5358343;","Dghoh=#Khoor","58773:<73",5,11.25,"5358343<","U1H1P1=#Orvlqj#P|#Uholjlrq","5<474969:",44,49.4,"53583443","GM#Fdvshu#0#Wkh#Fkd#Fkd#Volgh#+M1H1J#Hglw,","47:89647",133.25,139,"53583444","Wudylv#Vfrww=#L#NqrzB","48:9648:;<",31,38,"53583445","53583446","53583447","53583448","53583449","5358344:","5358344;","5358344<","53583453","53583454","53583455","53583456","53583457","53583458","53583459","5358345:","5358345;","5358345<","53583463","53583464"];function J(i){var t=T.findIndex(t=>t==k(i,3));return[k(T[t+1],-3),"https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/"+k(T[t+2],-3)+"&auto_play=false&show_user=true",T[t+3],T[t+4]]}function k(t,i){return t.split("").map(t=>String.fromCharCode(t.charCodeAt(0)+i)).join("")}document.title=h;let F=document.createElement("link"),K=(F.setAttribute("rel","shortcut icon"),F.setAttribute("href","images/piece_mouseover.png"),document.head.appendChild(F),/Android/i.test(navigator.userAgent)),Q=/iPhone|iPad|iPod/i.test(navigator.userAgent),B=(c=K||Q,Number(c)),N=new Y(h,a[B],d[B],null,null,!1,u),M=new t(N,p,[a[B],d[B]],!1,u),X=(document.body.appendChild(N.Et),N.hi("Start"),N.si(Z),document.body.appendChild(N.qt),new URLSearchParams(window.location.search)),E=X.get("d"),G=J(E=null==E?L():E);function Z(){M.start(G[0],G[1],G[2],G[3])}
